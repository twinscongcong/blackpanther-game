<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport"
content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<title>블랙팬서 슈팅</title>

<style>
html, body {
  margin: 0;
  padding: 0;
  width: 100%;
  height: 100%;
  overflow: hidden;
  background: black;
}

canvas {
  display: block;
}

/* 버튼 */
#jumpBtn, #shootBtn {
  position: fixed;
  bottom: 20px;
  width: 110px;
  height: 110px;
  border-radius: 50%;
  background: rgba(0,0,0,0.5);
  color: white;
  font-size: 22px;
  font-weight: bold;
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 10;
  user-select: none;
}

#jumpBtn { left: 20px; }
#shootBtn { right: 20px; }
</style>
</head>

<body>

<canvas id="game"></canvas>
<div id="jumpBtn">점프</div>
<div id="shootBtn">총</div>

<script>
/* ======================
   캔버스 / 좌표계
====================== */
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

let viewW = 0;
let viewH = 0;
const dpr = window.devicePixelRatio || 1;

function resize(){
  viewW = window.innerWidth;
  viewH = window.innerHeight;

  canvas.width  = viewW * dpr;
  canvas.height = viewH * dpr;
  canvas.style.width  = viewW + "px";
  canvas.style.height = viewH + "px";

  ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
}
window.addEventListener("resize", resize);
resize();

/* ======================
   이미지
====================== */
const pantherImg = new Image();
pantherImg.src = "panther.png";

const blockImg = new Image();
blockImg.src = "block.png";

const bgImg = new Image();
bgImg.src = "background.png";

/* ======================
   게임 변수
====================== */
const gravity = 0.9;
const groundY = () => viewH - 120;

const player = {
  x: 80,
  y: 0,
  w: 80,
  h: 80,
  vy: 0,
  onGround: false
};

let bullets = [];
let blocks = [];
let hp = 5;
const maxHp = 5;

/* ======================
   버튼 입력
====================== */
let jumpStart = 0;

jumpBtn.addEventListener("touchstart", e=>{
  e.preventDefault();
  jumpStart = Date.now();
});

jumpBtn.addEventListener("touchend", e=>{
  e.preventDefault();
  if(player.onGround){
    const t = Date.now() - jumpStart;
    player.vy = t < 200 ? -12 : -18;
    player.onGround = false;
  }
});

shootBtn.addEventListener("touchstart", e=>{
  e.preventDefault();
  bullets.push({
    x: player.x + player.w,
    y: player.y + player.h / 2 - 3,
    w: 14,
    h: 6
  });
});

/* ======================
   블럭 생성
====================== */
setInterval(()=>{
  const heights = [0, 90, 170];
  const sizes = [90, 70, 60];
  const i = Math.floor(Math.random() * 3);

  blocks.push({
    x: viewW,
    y: groundY() - heights[i],
    size: sizes[i]
  });
}, 1400);

/* ======================
   충돌 판정
====================== */
function hitBulletBlock(b, bl){
  return b.x < bl.x + bl.size &&
         b.x + b.w > bl.x &&
         b.y < bl.y + bl.size &&
         b.y + b.h > bl.y;
}

function hitPlayerBlock(p, bl){
  return p.x < bl.x + bl.size &&
         p.x + p.w > bl.x &&
         p.y < bl.y + bl.size &&
         p.y + p.h > bl.y;
}

/* ======================
   HP 표시
====================== */
function drawHP(){
  for(let i=0;i<maxHp;i++){
    ctx.fillStyle = i < hp ? "red" : "#555";
    ctx.fillRect(20 + i*26, 20, 20, 20);
  }
}

/* ======================
   게임 루프
====================== */
function update(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  /* 배경 */
  ctx.drawImage(bgImg, 0, 0, viewW, viewH);

  /* 플레이어 물리 */
  player.vy += gravity;
  player.y += player.vy;

  if(player.y >= groundY()){
    player.y = groundY();
    player.vy = 0;
    player.onGround = true;
  }

  /* 총알 이동 */
  for(let i=bullets.length-1;i>=0;i--){
    bullets[i].x += 12;
    if(bullets[i].x > viewW){
      bullets.splice(i,1);
    }
  }

  /* 블럭 이동 + 충돌 */
  for(let i=blocks.length-1;i>=0;i--){
    const bl = blocks[i];
    bl.x -= 4;

    if(hitPlayerBlock(player, bl)){
      blocks.splice(i,1);
      hp--;
      continue;
    }

    for(let j=bullets.length-1;j>=0;j--){
      if(hitBulletBlock(bullets[j], bl)){
        bullets.splice(j,1);
        blocks.splice(i,1);
        break;
      }
    }
  }

  /* 그리기 순서 */
  ctx.drawImage(pantherImg, player.x, player.y, player.w, player.h);

  ctx.fillStyle = "yellow";
  bullets.forEach(b=>{
    ctx.fillRect(b.x, b.y, b.w, b.h);
  });

  blocks.forEach(bl=>{
    ctx.drawImage(blockImg, bl.x, bl.y, bl.size, bl.size);
  });

  drawHP();

  requestAnimationFrame(update);
}

update();
</script>
</body>
</html>
