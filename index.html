<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport"
content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<title>블랙팬서 슈팅</title>

<style>
body {
  margin: 0;
  overflow: hidden;
  background: black;
}

canvas {
  display: block;
}

/* 가로 고정 */
@media screen and (orientation: portrait) {
  body {
    transform: rotate(90deg);
    transform-origin: center center;
    width: 100vh;
    height: 100vw;
    position: absolute;
    top: 0;
    left: 0;
  }
}

/* 버튼 */
#jumpBtn, #shootBtn {
  position: fixed;
  bottom: 20px;
  width: 120px;
  height: 120px;
  border-radius: 50%;
  background: rgba(0,0,0,0.45);
  color: white;
  font-size: 22px;
  font-weight: bold;
  display: flex;
  align-items: center;
  justify-content: center;
  user-select: none;
  z-index: 10;
}

#jumpBtn { left: 20px; }
#shootBtn { right: 20px; }
</style>
</head>

<body>

<canvas id="game"></canvas>
<div id="jumpBtn">점프</div>
<div id="shootBtn">총</div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

function resize(){
  if(innerWidth > innerHeight){
    canvas.width = innerWidth;
    canvas.height = innerHeight;
  } else {
    canvas.width = innerHeight;
    canvas.height = innerWidth;
  }
}
window.addEventListener("resize", resize);
resize();

/* 이미지 */
const pantherImg = new Image();
pantherImg.src = "panther.png";
const blockImg = new Image();
blockImg.src = "block.png";
const bgImg = new Image();
bgImg.src = "background.png";

/* 사운드 */
const AudioCtx = window.AudioContext || window.webkitAudioContext;
const audioCtx = new AudioCtx();

function shootSound(){
  const o = audioCtx.createOscillator();
  const g = audioCtx.createGain();
  o.frequency.value = 700;
  g.gain.value = 0.15;
  o.connect(g); g.connect(audioCtx.destination);
  o.start(); o.stop(audioCtx.currentTime+0.1);
}

function hitSound(){
  const o = audioCtx.createOscillator();
  const g = audioCtx.createGain();
  o.frequency.value = 200;
  g.gain.value = 0.2;
  o.connect(g); g.connect(audioCtx.destination);
  o.start(); o.stop(audioCtx.currentTime+0.2);
}

/* 배경음 */
const bgm = audioCtx.createOscillator();
const bgmGain = audioCtx.createGain();
bgm.frequency.value = 120;
bgmGain.gain.value = 0.03;
bgm.connect(bgmGain);
bgmGain.connect(audioCtx.destination);
bgm.start();

document.body.addEventListener("touchstart", ()=>{
  if(audioCtx.state==="suspended") audioCtx.resume();
},{once:true});

/* 게임 변수 */
const gravity = 0.9;
const groundY = ()=>canvas.height-120;

const player = {
  x: 80, y: 0, w: 80, h: 80,
  vy: 0, onGround: false
};

let bullets=[];
let blocks=[];
let particles=[];
let score=0;
let hp=5;
const maxHp=5;
let best = localStorage.getItem("bestScore") || 0;
let gameOver=false;

/* 버튼 조작 */
const jumpBtn = document.getElementById("jumpBtn");
const shootBtn = document.getElementById("shootBtn");
let jumpTime=0;

jumpBtn.addEventListener("touchstart",e=>{
  e.preventDefault();
  jumpTime=Date.now();
});
jumpBtn.addEventListener("touchend",e=>{
  e.preventDefault();
  jump(Date.now()-jumpTime);
});

shootBtn.addEventListener("touchstart",e=>{
  e.preventDefault();
  shoot();
});

/* 동작 */
function jump(t){
  if(!player.onGround) return;
  player.vy = t<200 ? -12 : -18;
  player.onGround=false;
}

function shoot(){
  bullets.push({
    x: player.x+player.w,
    y: player.y+40,
    w: 10, h: 4
  });
  shootSound();
}

function spawnBlock(){
  const types=[
    {y:groundY(), s:90, c:"brown"},
    {y:groundY()-90, s:70, c:"green"},
    {y:groundY()-170, s:60, c:"purple"}
  ];
  const t=types[Math.floor(Math.random()*3)];
  blocks.push({
    x: canvas.width,
    y: t.y,
    size: t.s,
    color: t.c
  });
}
setInterval(spawnBlock,1500);

function explode(x,y,c){
  for(let i=0;i<14;i++){
    particles.push({
      x,y,
      vx:(Math.random()-0.5)*6,
      vy:(Math.random()-0.5)*6,
      life:30,
      color:c
    });
  }
  hitSound();
}

function hit(a,b){
  return a.x < b.x+b.size &&
         a.x+a.w > b.x &&
         a.y < b.y+b.size &&
         a.y+a.h > b.y;
}

function drawStar(x,y,r,c){
  ctx.fillStyle=c;
  ctx.beginPath();
  for(let i=0;i<5;i++){
    ctx.lineTo(
      x+Math.cos((18+i*72)*Math.PI/180)*r,
      y-Math.sin((18+i*72)*Math.PI/180)*r
    );
    ctx.lineTo(
      x+Math.cos((54+i*72)*Math.PI/180)*(r/2),
      y-Math.sin((54+i*72)*Math.PI/180)*(r/2)
    );
  }
  ctx.closePath();
  ctx.fill();
}

function drawHP(){
  for(let i=0;i<maxHp;i++){
    ctx.fillStyle = i<hp ? "red" : "#aaa";
    ctx.fillRect(20+i*28,20,20,20);
  }
}

function endGame(){
  gameOver=true;
  if(score>best) localStorage.setItem("bestScore",score);
  ctx.fillStyle="black";
  ctx.font="40px Arial";
  ctx.fillText("게임 오버",canvas.width/2-90,canvas.height/2);
}

/* 루프 */
function update(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.drawImage(bgImg,0,0,canvas.width,canvas.height);

  if(!gameOver){
    player.vy+=gravity;
    player.y+=player.vy;
    if(player.y>=groundY()){
      player.y=groundY();
      player.vy=0;
      player.onGround=true;
    }
  }

  ctx.drawImage(pantherImg,player.x,player.y,player.w,player.h);

  bullets.forEach((b,i)=>{
    b.x+=10;
    ctx.fillRect(b.x,b.y,b.w,b.h);
    if(b.x>canvas.width) bullets.splice(i,1);
  });

  blocks.forEach((bl,i)=>{
    bl.x-=4;
    ctx.drawImage(blockImg,bl.x,bl.y,bl.size,bl.size);

    if(hit(player,bl)){
      blocks.splice(i,1);
      hp--;
      hitSound();
      if(hp<=0) endGame();
    }
  });

  bullets.forEach((b,bi)=>{
    blocks.forEach((bl,i)=>{
      if(hit(b,bl)){
        bullets.splice(bi,1);
        blocks.splice(i,1);
        explode(bl.x+bl.size/2, bl.y+bl.size/2, bl.color);
        score++;
      }
    });
  });

  particles.forEach((p,i)=>{
    p.x+=p.vx;
    p.y+=p.vy;
    p.life--;
    drawStar(p.x,p.y,6,p.color);
    if(p.life<=0) particles.splice(i,1);
  });

  drawHP();
  ctx.fillStyle="black";
  ctx.font="18px Arial";
  ctx.fillText("점수: "+score,20,80);
  ctx.fillText("최고: "+best,20,105);

  requestAnimationFrame(update);
}

update();
</script>
</body>
</html>
