<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport"
content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<title>블랙팬서 슈팅</title>

<style>
html, body {
  margin: 0;
  padding: 0;
  width: 100%;
  height: 100%;
  overflow: hidden;
  background: black;
}

#game {
  display: block;
  width: 100vw;
  height: 100vh;
}

/* 버튼 */
#jumpBtn, #shootBtn {
  position: absolute;
  bottom: 20px;
  width: 120px;
  height: 120px;
  border-radius: 50%;
  background: rgba(0,0,0,0.5);
  color: white;
  font-size: 22px;
  font-weight: bold;
  display: flex;
  align-items: center;
  justify-content: center;
  user-select: none;
  z-index: 10;
}

#jumpBtn { left: 20px; }
#shootBtn { right: 20px; }
</style>
</head>

<body>

<canvas id="game"></canvas>
<div id="jumpBtn">점프</div>
<div id="shootBtn">총</div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

/* ✅ 모든 기기 안전한 리사이즈 */
function resize(){
  const dpr = window.devicePixelRatio || 1;
  const w = Math.floor(document.documentElement.clientWidth);
  const h = Math.floor(document.documentElement.clientHeight);

  canvas.width = w * dpr;
  canvas.height = h * dpr;
  ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
}
window.addEventListener("resize", resize);
resize();

/* 이미지 */
const pantherImg = new Image();
pantherImg.src = "panther.png";
const blockImg = new Image();
blockImg.src = "block.png";
const bgImg = new Image();
bgImg.src = "background.png";

/* 사운드 */
const AudioCtx = window.AudioContext || window.webkitAudioContext;
const audioCtx = new AudioCtx();
document.body.addEventListener("touchstart", ()=>{
  if(audioCtx.state==="suspended") audioCtx.resume();
},{once:true});

function shootSound(){
  const o = audioCtx.createOscillator();
  const g = audioCtx.createGain();
  o.frequency.value = 700;
  g.gain.value = 0.15;
  o.connect(g); g.connect(audioCtx.destination);
  o.start(); o.stop(audioCtx.currentTime+0.1);
}

/* 게임 변수 */
const gravity = 0.9;
const groundY = ()=>canvas.height/dpr - 120;
let dpr = window.devicePixelRatio || 1;

const player = {
  x: 80, y: 0, w: 80, h: 80,
  vy: 0, onGround: false
};

let bullets=[], blocks=[];
let hp=5;

/* 버튼 */
const jumpBtn = document.getElementById("jumpBtn");
const shootBtn = document.getElementById("shootBtn");
let jumpTime=0;

jumpBtn.addEventListener("touchstart", e=>{
  e.preventDefault();
  jumpTime=Date.now();
});
jumpBtn.addEventListener("touchend", e=>{
  e.preventDefault();
  if(player.onGround){
    player.vy = (Date.now()-jumpTime<200)?-12:-18;
    player.onGround=false;
  }
});

shootBtn.addEventListener("touchstart", e=>{
  e.preventDefault();
  bullets.push({x:player.x+player.w,y:player.y+40,w:10,h:4});
  shootSound();
});

/* 블럭 */
setInterval(()=>{
  const levels=[0,90,170];
  const s=[90,70,60];
  const i=Math.floor(Math.random()*3);
  blocks.push({
    x: canvas.width/dpr,
    y: groundY()-levels[i],
    size: s[i]
  });
},1500);

function hit(a,b){
  return a.x<b.x+b.size &&
         a.x+a.w>b.x &&
         a.y<b.y+b.size &&
         a.y+a.h>b.y;
}

/* 루프 */
function update(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.drawImage(bgImg,0,0,canvas.width/dpr,canvas.height/dpr);

  player.vy+=gravity;
  player.y+=player.vy;
  if(player.y>=groundY()){
    player.y=groundY();
    player.vy=0;
    player.onGround=true;
  }

  ctx.drawImage(pantherImg,player.x,player.y,player.w,player.h);

  bullets.forEach((b,i)=>{
    b.x+=10;
    ctx.fillRect(b.x,b.y,b.w,b.h);
    if(b.x>canvas.width/dpr) bullets.splice(i,1);
  });

  blocks.forEach((bl,i)=>{
    bl.x-=4;
    ctx.drawImage(blockImg,bl.x,bl.y,bl.size,bl.size);
    if(hit(player,bl)){
      blocks.splice(i,1);
      hp--;
    }
  });

  requestAnimationFrame(update);
}
update();
</script>
</body>
</html>
