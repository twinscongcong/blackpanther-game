<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport"
content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<title>블랙팬서 슈팅</title>

<style>
html, body {
  margin: 0;
  padding: 0;
  background: black;
  overflow: hidden;
  width: 100%;
  height: 100%;
}

canvas {
  display: block;
  margin: auto;
}

#jumpBtn, #shootBtn {
  position: fixed;
  bottom: 20px;
  width: 110px;
  height: 110px;
  border-radius: 50%;
  background: rgba(0,0,0,0.5);
  color: white;
  font-size: 22px;
  font-weight: bold;
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 10;
}

#jumpBtn { left: 20px; }
#shootBtn { right: 20px; }
</style>
</head>

<body>

<canvas id="game"></canvas>
<div id="jumpBtn">점프</div>
<div id="shootBtn">총</div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

let gameW, gameH;
const dpr = window.devicePixelRatio || 1;

function resize(){
  const vw = window.innerWidth;
  const vh = window.innerHeight;

  gameW = Math.max(vw, vh);
  gameH = Math.min(vw, vh);

  canvas.width  = gameW * dpr;
  canvas.height = gameH * dpr;
  canvas.style.width  = gameW + "px";
  canvas.style.height = gameH + "px";

  ctx.setTransform(dpr,0,0,dpr,0,0);
}
window.addEventListener("resize", resize);
resize();

/* 이미지 */
const pantherImg = new Image();
pantherImg.src = "panther.png";
const blockImg = new Image();
blockImg.src = "block.png";
const bgImg = new Image();
bgImg.src = "background.png";

/* 오디오 */
const AudioCtx = window.AudioContext || window.webkitAudioContext;
const audioCtx = new AudioCtx();
document.body.addEventListener("touchstart", ()=>{
  if(audioCtx.state==="suspended") audioCtx.resume();
},{once:true});

function shootSound(){
  const o = audioCtx.createOscillator();
  const g = audioCtx.createGain();
  o.frequency.value = 700;
  g.gain.value = 0.15;
  o.connect(g); g.connect(audioCtx.destination);
  o.start(); o.stop(audioCtx.currentTime+0.1);
}

/* 게임 변수 */
const gravity = 0.9;
const groundY = () => gameH - 120;

const player = {
  x: 80, y: 0, w: 80, h: 80,
  vy: 0, onGround: false
};

let bullets = [];
let blocks = [];
let hp = 5;
const maxHp = 5;

/* 버튼 */
let jumpStart = 0;

jumpBtn.ontouchstart = e=>{
  e.preventDefault();
  jumpStart = Date.now();
};
jumpBtn.ontouchend = e=>{
  e.preventDefault();
  if(player.onGround){
    player.vy = (Date.now()-jumpStart < 200) ? -12 : -18;
    player.onGround = false;
  }
};

shootBtn.ontouchstart = e=>{
  e.preventDefault();
  bullets.push({
    x: player.x + player.w,
    y: player.y + player.h/2,
    w: 12,
    h: 6
  });
  shootSound();
};

/* 블럭 생성 */
setInterval(()=>{
  const heights = [0, 90, 170];
  const sizes = [90, 70, 60];
  const i = Math.floor(Math.random()*3);

  blocks.push({
    x: gameW,
    y: groundY() - heights[i],
    size: sizes[i]
  });
}, 1500);

/* 충돌 판정 (총알/블럭 분리) */
function hitRect(a, b){
  return a.x < b.x + b.w &&
         a.x + a.w > b.x &&
         a.y < b.y + b.h &&
         a.y + a.h > b.y;
}

function hitBlock(a, b){
  return a.x < b.x + b.size &&
         a.x + a.w > b.x &&
         a.y < b.y + b.size &&
         a.y + a.h > b.y;
}

/* HP */
function drawHP(){
  const y = gameH - 30;
  for(let i=0;i<maxHp;i++){
    ctx.fillStyle = i<hp ? "red" : "#555";
    ctx.fillRect(20 + i*26, y, 20, 20);
  }
}

/* 루프 */
function update(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.drawImage(bgImg,0,0,gameW,gameH);

  player.vy += gravity;
  player.y += player.vy;
  if(player.y >= groundY()){
    player.y = groundY();
    player.vy = 0;
    player.onGround = true;
  }

  ctx.drawImage(pantherImg, player.x, player.y, player.w, player.h);

  for(let i=bullets.length-1;i>=0;i--){
    const b = bullets[i];
    b.x += 10;
    ctx.fillRect(b.x, b.y, b.w, b.h);
    if(b.x > gameW) bullets.splice(i,1);
  }

  for(let i=blocks.length-1;i>=0;i--){
    const bl = blocks[i];
    bl.x -= 4;
    ctx.drawImage(blockImg, bl.x, bl.y, bl.size, bl.size);

    if(hitBlock(player, bl)){
      blocks.splice(i,1);
      hp--;
    }

    for(let j=bullets.length-1;j>=0;j--){
      if(hitBlock(bullets[j], bl)){
        bullets.splice(j,1);
        blocks.splice(i,1);
        break;
      }
    }
  }

  drawHP();
  requestAnimationFrame(update);
}
update();
</script>
</body>
</html>
