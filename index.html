
<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport"
content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<title>Î∏îÎûôÌå¨ÏÑú ÏäàÌåÖ</title>

<style>
html, body {
  margin: 0;
  padding: 0;
  width: 100%;
  height: 100%;
  overflow: hidden;
  background: black;
  overscroll-behavior: none;
}

canvas {
  position: fixed;
  top: 0;
  left: 0;
  z-index: 1;
}

/* Î≤ÑÌäº */
#jumpBtn, #shootBtn {
  position: fixed;
  bottom: 20px;
  width: 120px;
  height: 120px;
  border-radius: 50%;
  background: rgba(0,0,0,0.5);
  color: white;
  font-size: 22px;
  font-weight: bold;
  display: flex;
  align-items: center;
  justify-content: center;
  user-select: none;
  z-index: 10;
}

#jumpBtn { left: 20px; }
#shootBtn { right: 20px; }
</style>
</head>

<body>

<canvas id="game"></canvas>
<div id="jumpBtn">Ï†êÌîÑ</div>
<div id="shootBtn">Ï¥ù</div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

/* üî• Î™®Îì† Í∏∞Í∏∞ ÎåÄÏùë Í∞ÄÎ°ú ÌíÄÏä§ÌÅ¨Î¶∞ */
function resize(){
  const ratio = window.devicePixelRatio || 1;

  const vw = window.visualViewport
    ? visualViewport.width
    : window.innerWidth;

  const vh = window.visualViewport
    ? visualViewport.height
    : window.innerHeight;

  canvas.width = vw * ratio;
  canvas.height = vh * ratio;

  canvas.style.width = vw + "px";
  canvas.style.height = vh + "px";

  ctx.setTransform(ratio, 0, 0, ratio, 0, 0);
}

window.addEventListener("resize", resize);
if (window.visualViewport) {
  visualViewport.addEventListener("resize", resize);
}
resize();

/* Ïù¥ÎØ∏ÏßÄ */
const pantherImg = new Image();
pantherImg.src = "panther.png";
const blockImg = new Image();
blockImg.src = "block.png";
const bgImg = new Image();
bgImg.src = "background.png";

/* ÏÇ¨Ïö¥Îìú */
const AudioCtx = window.AudioContext || window.webkitAudioContext;
const audioCtx = new AudioCtx();

document.body.addEventListener("touchstart", ()=>{
  if(audioCtx.state==="suspended") audioCtx.resume();
},{once:true});

function shootSound(){
  const o = audioCtx.createOscillator();
  const g = audioCtx.createGain();
  o.frequency.value = 700;
  g.gain.value = 0.15;
  o.connect(g); g.connect(audioCtx.destination);
  o.start(); o.stop(audioCtx.currentTime+0.1);
}

function hitSound(){
  const o = audioCtx.createOscillator();
  const g = audioCtx.createGain();
  o.frequency.value = 200;
  g.gain.value = 0.2;
  o.connect(g); g.connect(audioCtx.destination);
  o.start(); o.stop(audioCtx.currentTime+0.2);
}

/* Í≤åÏûÑ Î≥ÄÏàò */
const gravity = 0.9;
const groundY = () => canvas.height - 120;

const player = {
  x: 80, y: 0, w: 80, h: 80,
  vy: 0, onGround: false
};

let bullets = [];
let blocks = [];
let particles = [];
let score = 0;
let hp = 5;
const maxHp = 5;
let best = localStorage.getItem("bestScore") || 0;
let gameOver = false;

/* Î≤ÑÌäº Ï°∞Ïûë */
const jumpBtn = document.getElementById("jumpBtn");
const shootBtn = document.getElementById("shootBtn");
let jumpTime = 0;

jumpBtn.addEventListener("touchstart", e=>{
  e.preventDefault();
  jumpTime = Date.now();
});

jumpBtn.addEventListener("touchend", e=>{
  e.preventDefault();
  if(player.onGround){
    player.vy = (Date.now()-jumpTime < 200) ? -12 : -18;
    player.onGround = false;
  }
});

shootBtn.addEventListener("touchstart", e=>{
  e.preventDefault();
  bullets.push({
    x: player.x + player.w,
    y: player.y + 40,
    w: 10, h: 4
  });
  shootSound();
});

/* Î∏îÎü≠ */
function spawnBlock(){
  const types = [
    {y: groundY(), s: 90},
    {y: groundY()-90, s: 70},
    {y: groundY()-170, s: 60}
  ];
  const t = types[Math.floor(Math.random()*3)];
  blocks.push({
    x: canvas.width,
    y: t.y,
    size: t.s
  });
}
setInterval(spawnBlock, 1500);

function hit(a,b){
  return a.x < b.x+b.size &&
         a.x+a.w > b.x &&
         a.y < b.y+b.size &&
         a.y+a.h > b.y;
}

function drawHP(){
  for(let i=0;i<maxHp;i++){
    ctx.fillStyle = i<hp ? "red" : "#999";
    ctx.fillRect(20+i*28,20,20,20);
  }
}

/* Í≤åÏûÑ Î£®ÌîÑ */
function update(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.drawImage(bgImg,0,0,canvas.width,canvas.height);

  if(!gameOver){
    player.vy += gravity;
    player.y += player.vy;
    if(player.y >= groundY()){
      player.y = groundY();
      player.vy = 0;
      player.onGround = true;
    }
  }

  ctx.drawImage(pantherImg,player.x,player.y,player.w,player.h);

  bullets.forEach((b,i)=>{
    b.x += 10;
    ctx.fillRect(b.x,b.y,b.w,b.h);
    if(b.x > canvas.width) bullets.splice(i,1);
  });

  blocks.forEach((bl,i)=>{
    bl.x -= 4;
    ctx.drawImage(blockImg,bl.x,bl.y,bl.size,bl.size);

    if(hit(player,bl)){
      blocks.splice(i,1);
      hp--;
      hitSound();
      if(hp<=0) gameOver=true;
    }
  });

  bullets.forEach((b,bi)=>{
    blocks.forEach((bl,i)=>{
      if(hit(b,bl)){
        bullets.splice(bi,1);
        blocks.splice(i,1);
        score++;
      }
    });
  });

  drawHP();
  ctx.fillStyle="black";
  ctx.font="18px Arial";
  ctx.fillText("Ï†êÏàò: "+score,20,80);
  ctx.fillText("ÏµúÍ≥†: "+best,20,105);

  requestAnimationFrame(update);
}
update();
</script>
</body>
</html>
